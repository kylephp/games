let mergedPeaks,splitPeaks;function exportPCM(e,t,n,o){t=t||1e4;const a=getPeaks(e=e||1024,o=o||0);let i=0,s=[].map.call(a,e=>(e>i&&(i=e),e)),r=1-i;return s=s.map(e=>Math.round((e+r)*t)/t)}function setLength(e){splitPeaks=[],mergedPeaks=[];const t=buffer?buffer.numberOfChannels:1;let n;for(n=0;n<t;n++)splitPeaks[n]=[],splitPeaks[n][2*(e-1)]=0,splitPeaks[n][2*(e-1)+1]=0;mergedPeaks[2*(e-1)]=0,mergedPeaks[2*(e-1)+1]=0}function getPeaks(e,t,n){t=t||0,n=n||e-1,setLength(e);const o=buffer.length/e,a=~~(o/10)||1,i=buffer.numberOfChannels;let s;for(s=0;s<i;s++){const e=splitPeaks[s],i=buffer.getChannelData(s);let r;for(r=t;r<=n;r++){const t=~~(r*o),n=~~(t+o);let c,l=0,u=0;for(c=t;c<n;c+=a){const e=i[c];e>u&&(u=e),e<l&&(l=e)}e[2*r]=u,e[2*r+1]=l,(0==s||u>mergedPeaks[2*r])&&(mergedPeaks[2*r]=u),(0==s||l<mergedPeaks[2*r+1])&&(mergedPeaks[2*r+1]=l)}}return mergedPeaks}kontra={init(e){var t=this.canvas=document.getElementById(e)||e||document.querySelector("canvas");this.context=t.getContext("2d")},_noop:new Function,_tick:new Function},kontra.gameLoop=function(e){let t,n,o,a,i=(e=e||{}).fps||60,s=0,r=1e3/i,c=1/i,l=!1===e.clearCanvas?kontra._noop:function(){kontra.context.clearRect(0,0,kontra.canvas.width,kontra.canvas.height)};function u(){if(n=requestAnimationFrame(u),o=performance.now(),a=o-t,t=o,!(a>1e3)){for(kontra._tick(),s+=a;s>=r;)d.update(c),s-=r;l(),d.render()}}let d={update:e.update,render:e.render,isStopped:!0,start(){t=performance.now(),this.isStopped=!1,requestAnimationFrame(u)},stop(){this.isStopped=!0,cancelAnimationFrame(n)}};return d},function(){let e={},t={},n={13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"};for(let e=0;e<26;e++)n[65+e]=(10+e).toString(36);for(i=0;i<10;i++)n[48+i]=""+i;addEventListener("keydown",function(o){let a=n[o.which];t[a]=!0,e[a]&&e[a](o)}),addEventListener("keyup",function(e){t[n[e.which]]=!1}),addEventListener("blur",function(e){t={}}),kontra.keys={bind(t,n){[].concat(t).map(function(t){e[t]=n})},unbind(t,n){[].concat(t).map(function(t){e[t]=n})},pressed:e=>!!t[e]}}(),function(){class e{constructor(e,t){this._x=e||0,this._y=t||0}add(e,t){this.x+=(e.x||0)*(t||1),this.y+=(e.y||0)*(t||1)}clamp(e,t,n,o){this._c=!0,this._a=e,this._b=t,this._d=n,this._e=o}get x(){return this._x}get y(){return this._y}set x(e){this._x=this._c?Math.min(Math.max(this._a,e),this._d):e}set y(e){this._y=this._c?Math.min(Math.max(this._b,e),this._e):e}}kontra.vector=((t,n)=>new e(t,n)),kontra.vector.prototype=e.prototype;class t{init(e,t,n,o){for(t in e=e||{},this.position=kontra.vector(e.x,e.y),this.velocity=kontra.vector(e.dx,e.dy),this.acceleration=kontra.vector(e.ddx,e.ddy),this.width=this.height=0,this.context=kontra.context,e)this[t]=e[t];if(n=e.image)this.image=n,this.width=n.width,this.height=n.height;else if(n=e.animations){for(t in n)this.animations[t]=n[t].clone(),o=o||n[t];this._ca=o,this.width=o.width,this.height=o.height}return this}get x(){return this.position.x}get y(){return this.position.y}get dx(){return this.velocity.x}get dy(){return this.velocity.y}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set x(e){this.position.x=e}set y(e){this.position.y=e}set dx(e){this.velocity.x=e}set dy(e){this.velocity.y=e}set ddx(e){this.acceleration.x=e}set ddy(e){this.acceleration.y=e}isAlive(){return this.ttl>0}collidesWith(e){return this.x<e.x+e.width&&this.x+this.width>e.x&&this.y<e.y+e.height&&this.y+this.height>e.y}update(e){this.advance(e)}render(){this.draw()}playAnimation(e){this._ca=this.animations[e],this._ca.loop||this._ca.reset()}advance(e){this.velocity.add(this.acceleration,e),this.position.add(this.velocity,e),this.ttl--,this._ca&&this._ca.update(e)}draw(){this.image?this.context.drawImage(this.image,this.x,this.y):this._ca?this._ca.render(this):(this.context.fillStyle=this.color,this.context.fillRect(this.x,this.y,this.width,this.height))}}kontra.sprite=(e=>(new t).init(e)),kontra.sprite.prototype=t.prototype}(),kontra.store={set(e,t){void 0===t?localStorage.removeItem(e):localStorage.setItem(e,JSON.stringify(t))},get(e){let t=localStorage.getItem(e);try{t=JSON.parse(t)}catch(e){}return t}},kontra.init();const ctx=kontra.context,mid=kontra.canvas.height/2,waveWidth=2,waveHeight=215,maxLength=kontra.canvas.width/waveWidth+2|0,defaultOptions={volume:1,uiScale:1,gameSpeed:1};let peaks,waveData,startBuffer,loop,bestTimes,bestTime,focusedBtn,fontMeasurement,gamepad,lastUsedInput,objectUrl,audio=document.getElementById("audio"),songName="AudioDashDefault.mp3",activeScenes=[],options=Object.assign({},defaultOptions,JSON.parse(localStorage.getItem("js13k-2018:options"))),fadeTime=450;function clamp(e,t,n){return Math.min(Math.max(t,e),n)}function getRandom(e,t){return Math.random()*(t-e)+e}function collidesWithShip(e,t){return ship.y<e+t&&ship.y+ship.height>e}function start(){startMove=-kontra.canvas.width/2|0,startCount=0,audio.currentTime=0,audio.volume=options.volume,audio.playbackRate=options.gameSpeed,ship.points=[],ship.y=mid,showTutorialBars=!0,isTutorial=!0,tutorialScene.show()}function gameOver(){audio.pause(),setBestTime(),gameOverScene.show(()=>restartBtn.focus())}function win(){audio.pause(),setBestTime(),winScene.show(()=>winMenuBtn.focus())}let uiSpacer=5;function setDimensions(e){let t="function"==typeof e.text?e.text():e.text;e.width=t.length*fontMeasurement+2*fontMeasurement,e.height=3*fontMeasurement,(e.center||"button"===e.type)&&(e.x=e.orgX-e.width/2),e.prev?e.y=e.prev.y+1.5*e.prev.height+uiSpacer/options.uiScale:e.y=e.orgY-e.height/2,e.y+=e.margin||0}function Button(e){e.orgX=e.x,e.orgY=e.y,e.type="button",setDimensions(e),e.render=function(){setDimensions(this),ctx.save(),setFont(25),ctx.fillStyle="#222",t.disabled&&(ctx.globalAlpha=clamp(this.parent.alpha-.65,0,1));let e=[this.x,this.y,this.width,this.height];ctx.fillRect.apply(ctx,e),this.focused?e.push(255,0,0):this.disabled?e.push(100,100,100):e.push(0,163,220),neonRect.apply(null,e),ctx.fillStyle="#fff",ctx.fillText(this.text,this.x+fontMeasurement,this.y+2*fontMeasurement),ctx.restore()},e.focus=function(){focusedBtn&&focusedBtn.blur&&focusedBtn.blur(),focusedBtn=this,this.focused=!0,this.domEl.focus()},e.blur=function(){this.focused=!1,focusedBtn=null};let t=kontra.sprite(e),n=document.createElement("button");return n.textContent=t.label||t.text,n.addEventListener("focus",t.focus.bind(t)),t.domEl=n,Object.defineProperty(t,"disabled",{get(){return this.domEl.disabled},set(e){this.domEl.disabled=e}}),t}function Text(e){e.orgX=e.x,e.orgY=e.y,setDimensions(e),e.render=function(){setDimensions(this);let e="function"==typeof this.text?this.text():this.text;this.lastText!==e&&(this.lastText=e,this.domEl.textContent=e),ctx.save(),ctx.fillStyle="#fff",setFont(25),ctx.fillText(e,this.x+fontMeasurement,this.y+2*fontMeasurement),ctx.restore()};let t=kontra.sprite(e),n=document.createElement("div");return"function"==typeof e.text&&(n.setAttribute("role","alert"),n.setAttribute("aria-live","assertive"),n.setAttribute("aria-atomic",!0)),t.domEl=n,t}let touchPressed,context=new(window.AudioContext||window.webkitAudioContext);function loadAudioBuffer(e){return new Promise((t,n)=>{let o=new XMLHttpRequest;o.responseType="arraybuffer",o.onload=function(){context.decodeAudioData(o.response,e=>{t(e)})},o.open("GET",e,!0),o.send()})}function loadAudio(e){return new Promise((t,n)=>{let o=document.createElement("audio");o.addEventListener("canplay",function(){t(this)}),o.onerror=function(e){console.error("e:",e),n(e)},o.src=e,o.load()})}async function uploadAudio(e){menuScene.hide(),loadingScene.show(),URL.revokeObjectURL(objectUrl);let t=e.currentTarget.files[0];objectUrl=URL.createObjectURL(t),songName=uploadFile.value.replace(/^.*fakepath/,"").substr(1),await fetchAudio(objectUrl),getBestTime(),loadingScene.hide(),startBtn.onDown()}async function fetchAudio(e){return buffer=await loadAudioBuffer(e),audio=await loadAudio(e),generateWaveData(),Promise.resolve()}function generateWaveData(){let e=audio.duration/8|0;peaks=exportPCM(1024*e),startBuffer=new Array(maxLength/2|0).fill(0);let t=peaks.map((e,t)=>e>=0?e:peaks[t-1]),n=mid,o=0,a=maxLength,i=0,s=0,r=(270-waveHeight+10)/(startBuffer.length+t.length),c=0,l=0,u=maxLength,d=0,h=0,f=0,x="AudioDashDefault.mp3"===songName;Random.setValues(peaks),waveData=startBuffer.concat(t).map((e,t,p)=>{let m=(190-r*t)/2;if(t>=maxLength*(x?4:1)){s+=i,h+=Math.abs(i)>1?d/(1.25*Math.abs(i)):d,(l<0&&h<l||l>0&&h>l)&&(h=l);let e=t-startBuffer.length;Random.seed(e),++c>=a&&(c=0,o=n,n=mid+Random.getNext(200),a=300+Random.getNext(100),i=(n-o)/a),++f>=u&&(f=0,lastYPos=l,u=110+Random.getNext(23),l=Random.getNext(m),d=(l-lastYPos)/u)}let v=1;for(let e=t-5;e<t;e++)p[e]<v&&(v=p[e]);let _=0;for(let e=t-20;e<t+20;e++)p[e]>_&&(_=p[e]);let g=maxLength*(x?15:3),w=t>g&&e-v>=.38&&Math.abs(i)<1.35,y=w?kontra.canvas.height/2-Math.max(65,1/e*35):160+e*waveHeight+r*t;return{x:t*waveWidth,y:0,width:waveWidth,height:y,offset:s,yOffset:w&&t>g?h:0,yPos:l}})}function neonRect(e,t,n,o,a,i,s){ctx.save(),ctx.strokeStyle="rgba("+a+","+i+","+s+",0.2)",ctx.lineWidth=10.5,ctx.strokeRect(e,t,n,o),ctx.lineWidth=8,ctx.strokeRect(e,t,n,o),ctx.lineWidth=5.5,ctx.strokeRect(e,t,n,o),ctx.lineWidth=3,ctx.strokeRect(e,t,n,o),ctx.strokeStyle="#fff",ctx.lineWidth=1.5,ctx.strokeRect(e,t,n,o),ctx.restore()}function drawLines(e,t){ctx.beginPath(),ctx.moveTo(e[0].x-t,e[0].y),e.forEach(e=>{ctx.lineTo(e.x-t,e.y)}),ctx.stroke()}function neonLine(e,t,n,o,a){e.length&&(ctx.save(),ctx.strokeStyle="rgba("+n+","+o+","+a+",0.2)",ctx.lineWidth=10.5,drawLines(e,t),ctx.lineWidth=8,drawLines(e,t),ctx.lineWidth=5.5,drawLines(e,t),ctx.lineWidth=3,drawLines(e,t),ctx.strokeStyle="#fff",ctx.lineWidth=1.5,drawLines(e,t),ctx.restore())}function neonText(e,t,n,o,a,i,s){ctx.save(),ctx.globalAlpha=.2,ctx.strokeStyle="rgb("+o+","+a+","+i+")",ctx.lineWidth=10.5,ctx.strokeText(e,t,n),ctx.lineWidth=8,ctx.strokeText(e,t,n),ctx.lineWidth=5.5,ctx.strokeText(e,t,n),ctx.lineWidth=3,ctx.strokeText(e,t,n),ctx.globalAlpha=1,ctx.strokeStyle="#fff",ctx.lineWidth=1.5,ctx.strokeText(e,t,n),ctx.restore()}function drawTimeUi(){ctx.save(),ctx.fillStyle="#222",ctx.beginPath(),ctx.moveTo(0,43*options.uiScale),ctx.lineTo(80*options.uiScale,43*options.uiScale);for(let e=1;e<=10*options.uiScale|0;e++)ctx.lineTo(80*options.uiScale+2*e,43*options.uiScale-2*e),ctx.lineTo(80*options.uiScale+2*e+2,43*options.uiScale-2*e);ctx.lineTo(170*options.uiScale,23*options.uiScale);for(let e=1;e<=10*options.uiScale|0;e++)ctx.lineTo(170*options.uiScale+2*e,23*options.uiScale-2*e),ctx.lineTo(170*options.uiScale+2*e+2,23*options.uiScale-2*e);ctx.lineTo(192*options.uiScale,0),ctx.lineTo(0,0),ctx.closePath(),ctx.fill(),ctx.beginPath();let e=kontra.canvas.height-25*options.uiScale;ctx.moveTo(0,e),ctx.lineTo(125*options.uiScale,e);for(let t=1;t<=10*options.uiScale|0;t++)ctx.lineTo(125*options.uiScale+2*t,e+2*t),ctx.lineTo(125*options.uiScale+2*t+2,e+2*t);ctx.lineTo(147*options.uiScale,kontra.canvas.height),ctx.lineTo(0,kontra.canvas.height),ctx.closePath(),ctx.fill(),ctx.fillStyle="#fdfdfd";let t=getTime(audio.currentTime);setFont(40),ctx.fillText(getSeconds(t).padStart(3," "),5*options.uiScale,35*options.uiScale),setFont(18),ctx.fillText(":"+getMilliseconds(t).padStart(2,"0")+"\nTIME",80*options.uiScale,17*options.uiScale),ctx.fillText(bestTime.padStart(6," ")+"\nBEST",5*options.uiScale,kontra.canvas.height-5*options.uiScale),ctx.restore()}function drawAButton(e,t){ctx.save(),ctx.fillStyle="green",ctx.beginPath(),ctx.arc(e,t,fontMeasurement,0,2*Math.PI),ctx.fill(),ctx.fillStyle="black",setFont(27),ctx.fillText("A",e-fontMeasurement/2,t+fontMeasurement/2),ctx.fillStyle="white",setFont(25),ctx.fillText("A",e-fontMeasurement/2,t+fontMeasurement/2),ctx.restore()}function showHelpText(){ctx.save(),"keyboard"===lastUsedInput?(setFont(18),ctx.fillStyle="white",ctx.fillText("[Spacebar] Select",50-fontMeasurement,kontra.canvas.height-50+fontMeasurement/2.5)):"gamepad"===lastUsedInput&&(drawAButton(50,kontra.canvas.height-50),setFont(18),ctx.fillStyle="white",ctx.fillText("Select",50+1.75*fontMeasurement,kontra.canvas.height-50+fontMeasurement/2.5)),ctx.restore()}function setFont(e){ctx.font=e*options.uiScale+"px 'Lucida Console', Monaco, monospace"}function setFontMeasurement(){fontMeasurement=15*options.uiScale}uploadFile.addEventListener("change",uploadAudio);let lastInputTime=0;function handleOnDown(e){let t,n;if(touchPressed=!0,-1!==e.type.indexOf("mouse")){if("touch"===lastUsedInput&&performance.now()-lastInputTime<1e3)return;lastUsedInput="mouse",t=e.pageX,n=e.pageY}else lastUsedInput="touch",t=(e.touches[0]||e.changedTouches[0]).pageX,n=(e.touches[0]||e.changedTouches[0]).pageY;let o=t-kontra.canvas.offsetLeft,a=n-kontra.canvas.offsetTop,i=kontra.canvas;for(;i=i.offsetParent;)o-=i.offsetLeft,a-=i.offsetTop;let s=kontra.canvas.offsetHeight/kontra.canvas.height;o/=s,a/=s;for(let e,t=activeScenes.length-1;e=activeScenes[t];t--)e.children&&e.children.forEach(e=>{if(!e.disabled&&e.parent.active&&e.onDown&&e.collidesWith({x:o-5,y:a-5,width:10,height:10}))return e.onDown(),void e.blur()});lastInputTime=performance.now()}function handleOnUp(){touchPressed=!1}function handleArrowDownUp(e){let t=activeScenes[activeScenes.length-1],n=t.children.indexOf(focusedBtn);for(;;){if((n+=e)<0||n>t.children.length-1)return;let o=t.children[n];if(o&&o.focus&&!o.disabled){o.focus();break}}}function applyDeadzone(e,t){return percentage=(Math.abs(e)-t)/(1-t),percentage<0&&(percentage=0),percentage*(e>0?1:-1)}window.addEventListener("mousedown",handleOnDown),window.addEventListener("touchstart",handleOnDown),window.addEventListener("mouseup",handleOnUp),window.addEventListener("touchend",handleOnUp),window.addEventListener("blur",handleOnUp),window.addEventListener("beforeunload",()=>{URL.revokeObjectURL(objectUrl)}),window.addEventListener("contextmenu",e=>(e.preventDefault(),e.stopPropagation(),!1)),kontra.keys.bind("space",()=>{lastUsedInput="keyboard",focusedBtn&&focusedBtn.onDown&&focusedBtn.onDown()}),kontra.keys.bind("up",e=>{lastUsedInput="keyboard",e.preventDefault(),handleArrowDownUp(-1)}),kontra.keys.bind("down",e=>{lastUsedInput="keyboard",e.preventDefault(),handleArrowDownUp(1)});let aDt=1,aDuration=0,axesDt=1,axesDuration=0;function updateGamepad(){if(!navigator.getGamepads)return;if(!(gamepad=navigator.getGamepads()[0]))return;gamepad.buttons[0].pressed?(lastUsedInput="gamepad",aDuration+=1/60,aDt+=1/60):(aDuration=0,aDt=1),(aDt>.3||aDuration>.3&&aDt>.1)&&gamepad.buttons[0].pressed&&focusedBtn&&focusedBtn.onDown&&(aDt=0,focusedBtn.onDown());let e=applyDeadzone(gamepad.axes[1],.5),t=e<0||gamepad.buttons[12].pressed,n=e>0||gamepad.buttons[13].pressed;t||n?(lastUsedInput="gamepad",axesDuration+=1/60,axesDt+=1/60):(axesDuration=0,axesDt=1),(axesDt>.3||axesDuration>.3&&axesDt>.1)&&(t?(axesDt=0,handleArrowDownUp(-1)):n&&(axesDt=0,handleArrowDownUp(1)))}let updateCounter=0,numUpdates=0;function getSign(e){return e<0?-1:e>0?1:0}(loop=kontra.gameLoop({update(){if(updateGamepad(),activeScenes.forEach(e=>e.update()),(tutorialScene.active||gameScene.active)&&!gameOverScene.active&&!winScene.active)for(numUpdates=0,updateCounter+=audio.playbackRate;updateCounter>=1;)numUpdates++,updateCounter--,ship.update();!tutorialScene.active||isTutorial||tutorialScene.isHidding||tutorialScene.hide(()=>{for(let e,t=0,n=ship.points.length-1;e=ship.points[n];n--)e.x=0-tutorialMoveInc*t++;gameScene.show()})},render(){showTutorialBars&&(ctx.fillStyle="#00a3dc",ctx.fillRect(0,0,kontra.canvas.width,160),ctx.fillRect(0,kontra.canvas.height-160,kontra.canvas.width,160)),activeScenes.forEach(e=>e.render()),(menuScene.active||optionsScene.active)&&showHelpText(),tutorialScene.active&&(tutorialMove+=tutorialMoveInc,ship.render(tutorialMove),ship.points.length>maxLength/2&&ship.points.shift())}})).start();let Random={values:[],value:null,index:null,numNegatives:0,numPositives:0,setValues:function(e){this.values=e,this.numNegatives=0,this.numPositives=0},seed:function(e){this.index=e,this.value=this.values[e]},getNext:function(e){let t=getSign(this.value);(-1===t&&this.numNegatives-this.numPositives>100||1===t&&this.numPositives-this.numNegatives>100)&&(t=-t),-1===t?this.numNegatives++:this.numPositives++;let n=t*(e-e*Math.abs(this.value)),o=1e4*this.value%100*5|0,a=this.index-o;return(a<0||a>this.values.length-1)&&(a=this.index+o),this.seed(a),n}},scenes=[];function Scene(e){let t=document.createElement("div");t.hidden=!0,uiScenes.appendChild(t);let n={name:e,alpha:0,active:!1,children:[],inc:.05,isHidding:!1,hide(e){focusedBtn&&focusedBtn.blur(),this.isHidding=!0,t.hidden=!0,this.alpha=1,this.inc=-.05,setTimeout(()=>{this.isHidding=!1,this.active=!1,activeScenes.splice(activeScenes.indexOf(this),1),e&&e()},fadeTime)},show(e){this.active=!0,t.hidden=!1,activeScenes.push(this),this.alpha=0,this.inc=.05,setTimeout(()=>{this.onShow&&this.onShow(),e&&e()},fadeTime)},add(){Array.from(arguments).forEach(e=>{e.parent=this,this.children.push(e),e.domEl&&t.appendChild(e.domEl)})},update(){this.children.forEach(e=>{e.update&&e.update()})},render(){this.alpha=clamp(this.alpha+this.inc,0,1),ctx.save(),ctx.globalAlpha=this.alpha,this.children.forEach(e=>e.render()),ctx.restore()}};return scenes.push(n),n}let menuScene=Scene("menu");menuScene.add({render(){ctx.save();return neonLine([{x:50,y:262},{x:80,y:262},{x:88,y:270},{x:96,y:278},{x:104,y:281},{x:112,y:279},{x:120,y:272},{x:128,y:264},{x:136,y:256},{x:144,y:249},{x:152,y:247},{x:160,y:250},{x:168,y:258},{x:176,y:266},{x:206,y:266}],0,0,163,220),ctx.font="150px 'Lucida Console', Monaco, monospace",neonText("AUDIO",50,200,0,163,220),neonText("DASH",231,315,255,0,0),ctx.restore(),ctx.fillStyle="#fff",ctx.font="30px 'Lucida Console', Monaco, monospace",ctx.fillText("Play the Wave",202,360),""}});let startBtn=Button({x:kontra.canvas.width/2,y:kontra.canvas.height/2,text:"START",onDown(){audio.play(),audio.pause(),menuScene.hide(()=>{start()})}}),optionsBtn=Button({x:kontra.canvas.width/2,prev:startBtn,text:"OPTIONS",onDown(){menuScene.hide(()=>{optionsScene.show()})}});menuScene.add(startBtn,optionsBtn);let loadingScene=Scene("upload"),loadingTimer=0,loadingText=Text({x:245,y:kontra.canvas.height/2,text(){let e="LOADING";return++loadingTimer>=60&&(e+="."),loadingTimer>=120&&(e+="."),loadingTimer>=180&&(e+="."),loadingTimer>=240&&(loadingTimer=0),e}});loadingScene.add(loadingText);let beforeOptions,focusEl,opts=[{name:"volume",minValue:0,maxValue:1,inc:.05},{name:"uiScale",minValue:1,maxValue:1.5,inc:.05},{name:"gameSpeed",minValue:.1,maxValue:2,inc:.05}],optionsScene=Scene("options");optionsScene.onShow=(()=>{beforeOptions=Object.assign({},options),focusEl.domEl.focus()});let startY=200,optionTexts=[];opts.forEach((e,t)=>{let n=e.name.replace(/([A-Z])/g," $1").toUpperCase(),o=Text({x:50,y:0===t?startY:null,prev:t>0?optionTexts[t-1]:null,text:n}),a=Text({x:475,y:0===t?startY:null,center:!0,prev:t>0?optionTexts[t-1]:null,text:()=>(""+Math.round(100*options[e.name])).padStart(3," ")+"%"}),i=Button({x:375,y:0===t?startY:null,prev:t>0?optionTexts[t-1]:null,text:"-",label:"Decrease "+n,update(){this.disabled=options[e.name]===e.minValue},onDown(){r(-e.inc)}});0===t&&(focusEl=i);let s=Button({x:575,y:0===t?startY:null,prev:t>0?optionTexts[t-1]:null,text:"+",label:"Increase "+n,update(){this.disabled=options[e.name]===e.maxValue},onDown(){r(e.inc)}});function r(t){let n=clamp(options[e.name]+t,e.minValue,e.maxValue);options[e.name]=n,setFontMeasurement()}optionsScene.add(o,a,i,s),optionTexts.push(o)});let saveBtn=Button({x:kontra.canvas.width/2,prev:optionTexts[optionTexts.length-1],margin:45,text:"SAVE",onDown(){localStorage.setItem("js13k-2018:options",JSON.stringify(options)),optionsScene.hide(()=>{menuScene.show(()=>startBtn.domEl.focus())})}}),cancelBtn=Button({x:kontra.canvas.width/2,prev:saveBtn,text:"CANCEL",onDown(){optionsScene.hide(()=>{options=beforeOptions,setFontMeasurement(),menuScene.show(()=>startBtn.domEl.focus())})}});optionsScene.add(saveBtn,cancelBtn);let startMove,startCount,isTutorial=!0,tutorialMove=0,tutorialMoveInc=5,showTutorialBars=!1,tutorialScene=Scene("tutorial"),tutorialText=Text({x:kontra.canvas.width/2,y:kontra.canvas.height/2-200,center:!0,text:()=>"Tap or Hold"});tutorialScene.add(tutorialText);let shipIndex,gameScene=Scene("game");gameScene.add({render(){let e,t,n=0;audio.currentTime?n=(e=Math.round(audio.currentTime/audio.duration*(peaks.length*waveWidth)))/waveWidth|0:(e=startMove+tutorialMoveInc*startCount,gameOverScene.active||(startCount++,e>=0&&(showTutorialBars=!1,audio.play()))),shipIndex=n+maxLength/2;for(let o=n;o<n+maxLength&&waveData[o];o++){let n=waveData[o],a=n.x-e,i=n.y,s=kontra.canvas.height-n.height-n.offset+n.yOffset,r=n.height-n.offset+n.yOffset,c=n.height+n.offset-n.yOffset;if(a>waveWidth*(maxLength/2-1)&&a<waveWidth*(maxLength/2+1)){if(t=n,!gameOverScene.active&&(collidesWithShip(i,r)||collidesWithShip(s,c)||ship.y<-50||ship.y>kontra.canvas.height+50))return gameOver()}else ctx.fillStyle="#00a3dc",ctx.fillRect(a,i,n.width,r),ctx.fillRect(a,s,n.width,c)}if(t){let n=t.x-e-waveWidth,o=t.width+2*waveWidth,a=t.y,i=kontra.canvas.height-t.height-t.offset+t.yOffset,s=t.height-t.offset+t.yOffset,r=t.height+t.offset-t.yOffset;neonRect(n,a,o,s,255,0,0),neonRect(n,i,o,r,255,0,0)}for(ship.render(e);ship.points.length&&ship.points[0].x-e<0-ship.width;)ship.points.shift();drawTimeUi(),!winScene.active&&waveData[waveData.length-1].x-e<=kontra.canvas.width/2&&win()}});let gameOverScene=Scene("gameOver"),gameOverText=Text({x:kontra.canvas.width/2,y:kontra.canvas.height/2,center:!0,text:"GAME OVER"}),restartBtn=Button({x:kontra.canvas.width/2,prev:gameOverText,text:"RESTART",onDown(){showTutorialBars=!0,gameOverScene.hide(),gameScene.hide(()=>start())}}),menuBtn=Button({x:kontra.canvas.width/2,prev:restartBtn,text:"MAIN MENU",onDown(){gameScene.hide(()=>{showTutorialBars=!1}),gameOverScene.hide(()=>{menuScene.show(()=>startBtn.domEl.focus())})}});gameOverScene.add(gameOverText,restartBtn,menuBtn);let winScene=Scene("win"),winText=Text({x:kontra.canvas.width/2,y:kontra.canvas.height/2,center:!0,text:"SONG COMPLETED!"}),winMenuBtn=Button({x:kontra.canvas.width/2,prev:winText,text:"MAIN MENU",onDown(){gameScene.hide(),winScene.hide(()=>{menuScene.show(()=>startBtn.domEl.focus())})}});winScene.add(winText,winMenuBtn);let ship=kontra.sprite({x:kontra.canvas.width/2-waveWidth/2,y:kontra.canvas.height/2-waveWidth/2,width:waveWidth,height:waveWidth,gravity:5,points:[],maxAcc:8,update(){if(kontra.keys.pressed("space")||touchPressed||gamepad&&gamepad.buttons[0].pressed?(this.ddy=-this.gravity,isTutorial=!1):this.ddy=this.gravity,isTutorial)return;this.y+=this.dy,this.dy+=this.ddy;let e=this.maxAcc;Math.sqrt(this.dy*this.dy)>e&&(this.dy=this.dy<0?-e:e)},render(e){numUpdates>=1&&!gameOverScene.active&&!winScene.active&&this.points.push({x:this.x+e,y:this.y+1}),neonRect(this.x,this.y,this.width,this.height,0,163,220),neonLine(this.points,e,0,163,220)}});var sonantx;!function(){"use strict";var e=2,t=33,n=null;function o(e){return Math.sin(6.283184*e)}var a=[o,function(e){return o(e)<0?-1:1},function(e){return e%1-.5},function(e){var t=e%1*4;return t<2?t-1:3-t}];function i(e){return.00390625*Math.pow(1.059463094,e-128)}function s(n,o){setTimeout(function(){var a=new Uint8Array(n*e*2),i=a.length-2,s=function(){for(var e=new Date,n=0;i>=0;)if(a[i]=0,a[i+1]=128,i-=2,(n+=1)%1e3==0&&new Date-e>t)return void setTimeout(s,0);setTimeout(function(){o(a)},0)};setTimeout(s,0)},0)}function r(e,n,o,a,i){var s=o.fx_delay_time*a>>1,r=o.fx_delay_amt/255,c=0,l=function(){for(var o=new Date,a=0;c<n-s;){var u=4*c,d=4*(c+s),h=e[d]+(e[d+1]<<8)+(e[u+2]+(e[u+3]<<8)-32768)*r;if(e[d]=255&h,e[d+1]=h>>8&255,h=e[d+2]+(e[d+3]<<8)+(e[u]+(e[u+1]<<8)-32768)*r,e[d+2]=255&h,e[d+3]=h>>8&255,++c,(a+=1)%1e3==0&&new Date-o>t)return void setTimeout(l,0)}setTimeout(i,0)};setTimeout(l,0)}(sonantx={}).AudioGenerator=function(t){this.mixBuf=t,this.waveSize=t.length/e/2},sonantx.AudioGenerator.prototype.getWave=function(){var t,n,o,a,i,s,r,c=this.mixBuf,l=this.waveSize*e*2;for(s=(i=l-8)-36,a=String.fromCharCode(82,73,70,70,255&i,i>>8&255,i>>16&255,i>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&s,s>>8&255,s>>16&255,s>>24&255),t=0;t<l;){for(o="",n=0;n<256&&t<l;++n,t+=2)r=(r=4*(c[t]+(c[t+1]<<8)-32768))<-32768?-32768:r>32767?32767:r,o+=String.fromCharCode(255&r,r>>8&255);a+=o}return a},sonantx.AudioGenerator.prototype.getAudio=function(){var e=this.getWave(),t=new Audio("data:audio/wav;base64,"+btoa(e));return t.preload="none",t.load(),t},sonantx.AudioGenerator.prototype.getAudioBuffer=function(o){null===n&&(n=new AudioContext);var a=this.mixBuf,i=this.waveSize,s=n.createBuffer(e,this.waveSize,44100),r=s.getChannelData(0),c=s.getChannelData(1),l=0,u=function(){for(var e=new Date,n=0;l<i;){var d=4*(a[4*l]+(a[4*l+1]<<8)-32768);if(d=d<-32768?-32768:d>32767?32767:d,r[l]=d/32768,d=(d=4*(a[4*l+2]+(a[4*l+3]<<8)-32768))<-32768?-32768:d>32767?32767:d,c[l]=d/32768,l+=1,(n+=1)%1e3==0&&new Date-e>t)return void setTimeout(u,0)}setTimeout(function(){o(s)},0)};setTimeout(u,0)},sonantx.SoundGenerator=function(e,t){this.instr=e,this.rowLen=t||5605,this.osc_lfo=a[e.lfo_waveform],this.osc1=a[e.osc1_waveform],this.osc2=a[e.osc2_waveform],this.attack=e.env_attack,this.sustain=e.env_sustain,this.release=e.env_release,this.panFreq=Math.pow(2,e.fx_pan_freq-8)/this.rowLen,this.lfoFreq=Math.pow(2,e.lfo_freq-8)/this.rowLen},sonantx.SoundGenerator.prototype.genSound=function(e,t,n){new Date;for(var a=0,s=0,r=i(e+12*(this.instr.osc1_oct-8)+this.instr.osc1_det)*(1+8e-4*this.instr.osc1_detune),c=i(e+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),l=this.instr.fx_resonance/255,u=0,d=0,h=this.attack+this.sustain+this.release-1;h>=0;--h){var f=h+n,x=this.osc_lfo(f*this.lfoFreq)*this.instr.lfo_amt/512+.5,p=1;h<this.attack?p=h/this.attack:h>=this.attack+this.sustain&&(p-=(h-this.attack-this.sustain)/this.release);var m=r;this.instr.lfo_osc1_freq&&(m+=x),this.instr.osc1_xenv&&(m*=p*p),a+=m;var v=this.osc1(a)*this.instr.osc1_vol;m=c,this.instr.osc2_xenv&&(m*=p*p),s+=m,v+=this.osc2(s)*this.instr.osc2_vol,this.instr.noise_fader&&(v+=(2*Math.random()-1)*this.instr.noise_fader*p),v*=p/255;var _=this.instr.fx_freq;this.instr.lfo_fx_freq&&(_*=x);var g=l*(v-d)-(u+=(_=1.5*Math.sin(3.141592*_/44100))*d);switch(d+=_*g,this.instr.fx_filter){case 1:v=g;break;case 2:v=u;break;case 3:v=d;break;case 4:v=u+g}if(m=o(f*this.panFreq)*this.instr.fx_pan_amt/512+.5,v*=39*this.instr.env_master,(f*=4)+3<t.length){var w=t[f]+(t[f+1]<<8)+v*(1-m);t[f]=255&w,t[f+1]=w>>8&255,w=t[f+2]+(t[f+3]<<8)+v*m,t[f+2]=255&w,t[f+3]=w>>8&255}}},sonantx.SoundGenerator.prototype.getAudioGenerator=function(e,t){var n=this.attack+this.sustain+this.release-1+32*this.rowLen,o=this;s(n,function(a){o.genSound(e,a,0),r(a,n,o.instr,o.rowLen,function(){t(new sonantx.AudioGenerator(a))})})},sonantx.SoundGenerator.prototype.createAudio=function(e,t){this.getAudioGenerator(e,function(e){t(e.getAudio())})},sonantx.SoundGenerator.prototype.createAudioBuffer=function(e,t){this.getAudioGenerator(e,function(e){e.getAudioBuffer(t)})},sonantx.MusicGenerator=function(e){this.song=e,this.waveSize=44100*e.songLen},sonantx.MusicGenerator.prototype.generateTrack=function(n,o,a){var i=this;s(this.waveSize,function(s){var c=i.waveSize,l=i.waveSize*e*2,u=i.song.rowLen,d=i.song.endPattern,h=new sonantx.SoundGenerator(n,u),f=0,x=0,p=0,m=function(){for(var e=new Date;;)if(32!==p){if(x===d-1)return void setTimeout(v,0);var o=n.p[x];if(o){var a=n.c[o-1].n[p];a&&h.genSound(a,s,f)}if(f+=u,p+=1,new Date-e>t)return void setTimeout(m,0)}else p=0,x+=1},v=function(){r(s,c,n,u,g)},_=0,g=function(){for(var e=new Date,n=0;_<l;){var i=o[_]+(o[_+1]<<8)+s[_]+(s[_+1]<<8)-32768;if(o[_]=255&i,o[_+1]=i>>8&255,_+=2,(n+=1)%1e3==0&&new Date-e>t)return void setTimeout(g,0)}setTimeout(a,0)};setTimeout(m,0)})},sonantx.MusicGenerator.prototype.getAudioGenerator=function(e){var t=this;s(this.waveSize,function(n){var o=0,a=function(){o<t.song.songData.length?(o+=1,t.generateTrack(t.song.songData[o-1],n,a)):e(new sonantx.AudioGenerator(n))};a()})},sonantx.MusicGenerator.prototype.createAudio=function(e){this.getAudioGenerator(function(t){e(t.getAudio())})},sonantx.MusicGenerator.prototype.createAudioBuffer=function(e){this.getAudioGenerator(function(t){t.getAudioBuffer(e)})}}();var song={rowLen:2242,endPattern:49,songData:[{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:255,osc1_waveform:0,osc2_oct:7,osc2_det:0,osc2_detune:0,osc2_xenv:1,osc2_vol:255,osc2_waveform:0,noise_fader:0,env_attack:50,env_sustain:150,env_release:4800,env_master:200,fx_filter:2,fx_freq:600,fx_resonance:254,fx_delay_time:0,fx_delay_amt:0,fx_pan_freq:0,fx_pan_amt:0,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0,p:[1,1,1,2,1,1,1,1,1,1,1,3,1,1,1,1,1,1,1,3,1,1,1,1,1,1,1,3,4,4,4,4,4,4,4,3,1,1,1,1,1,1,1,3,1,1,1,2],c:[{n:[128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[128,0,0,0,0,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,0,0,0,0,128,0,0,0]},{n:[128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,0,0,0,0,128,0,0,0,0,0,0,0,0,0]},{n:[128,0,0,0,0,0,128,0,0,0,0,0,128,0,0,0,0,0,0,0,128,0,128,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:8,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:160,osc1_waveform:0,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:1,osc2_vol:160,osc2_waveform:0,noise_fader:210,env_attack:50,env_sustain:200,env_release:6800,env_master:160,fx_filter:4,fx_freq:11025,fx_resonance:254,fx_delay_time:6,fx_delay_amt:0,fx_pan_freq:5,fx_pan_amt:61,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:4,lfo_amt:0,lfo_waveform:0,p:[1,1,1,2,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,2,4,4,4,4,4,4,4,2,1,1,1,1,1,1,1,1,1,1,1,1],c:[{n:[0,0,0,0,0,0,0,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,128,0,0,0,0,0,0,0,0,0,0,0,128,0,0,0,128,0,0,0,128,0,128,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,0,0,0,0,0,0,128,0,0,0,0,0,0,0]}]},{osc1_oct:6,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:255,osc1_waveform:1,osc2_oct:7,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:154,osc2_waveform:1,noise_fader:0,env_attack:197,env_sustain:88,env_release:10614,env_master:45,fx_filter:2,fx_freq:4425,fx_resonance:163,fx_delay_time:8,fx_delay_amt:119,fx_pan_freq:3,fx_pan_amt:158,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0,p:[2,3,2,3,2,3,2,3,2,3,4,5,2,3,2,3,2,3,4,5,2,3,2,3,2,3,4,5,0,0,0,0,0,0,0,0,2,3,2,3,2,3,4,5,2,3,2,2],c:[{n:[0,0,0,0,0,0,0,0,128,0,0,0,0,0,0,0,0,0,0,0,133,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,135,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,135,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,143,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,142,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,133,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,133,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,0,0,0,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:144,osc1_waveform:3,osc2_oct:6,osc2_det:0,osc2_detune:9,osc2_xenv:1,osc2_vol:162,osc2_waveform:0,noise_fader:255,env_attack:663,env_sustain:0,env_release:1584,env_master:37,fx_filter:1,fx_freq:6531,fx_resonance:132,fx_delay_time:12,fx_delay_amt:9,fx_pan_freq:0,fx_pan_amt:0,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:5,lfo_amt:0,lfo_waveform:0,p:[0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,0,0],c:[{n:[0,0,0,0,0,0,0,140,0,0,0,0,0,0,0,0,0,0,0,145,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,147,0,0,0,0,0,0,0,0,0,0,0,152,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[152,0,0,0,152,0,0,0,152,0,0,0,152,0,0,0,152,0,0,0,152,0,0,0,152,0,0,0,152,0,0,0]},{n:[152,0,152,0,152,0,0,0,152,0,152,0,152,0,0,0,152,0,152,0,152,0,0,0,152,0,152,0,152,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:63,osc1_waveform:2,osc2_oct:7,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:125,osc2_waveform:0,noise_fader:0,env_attack:444,env_sustain:3706,env_release:10614,env_master:124,fx_filter:0,fx_freq:2727,fx_resonance:199,fx_delay_time:0,fx_delay_amt:125,fx_pan_freq:3,fx_pan_amt:47,lfo_osc1_freq:1,lfo_fx_freq:0,lfo_freq:14,lfo_amt:0,lfo_waveform:1,p:[0,0,0,0,2,2,2,2,2,2,3,4,2,2,2,2,2,2,3,4,2,2,2,2,2,2,3,4,2,2,2,2,2,2,3,4,2,2,2,2,2,2,3,4],c:[{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,159,0,0,0,157,0,157,0,0,0,157,0,0,0,152,0,0]},{n:[123,0,0,0,126,0,0,0,128,0,0,0,130,0,0,0,131,0,0,0,130,0,0,0,128,0,0,0,0,0,0,0]},{n:[130,0,0,0,131,0,0,0,128,0,0,0,126,0,0,0,125,0,0,0,123,0,0,0,121,0,0,0,0,0,0,0]},{n:[123,0,0,0,121,0,0,0,123,0,0,0,125,0,0,0,126,0,0,0,125,0,0,0,121,0,0,0,123,0,0,0]}]},{osc1_oct:9,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:64,osc1_waveform:1,osc2_oct:5,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:128,osc2_waveform:3,noise_fader:0,env_attack:1776,env_sustain:7105,env_release:19736,env_master:119,fx_filter:1,fx_freq:1523,fx_resonance:128,fx_delay_time:10,fx_delay_amt:39,fx_pan_freq:3,fx_pan_amt:92,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:2,lfo_amt:0,lfo_waveform:3,p:[0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,3,2,2,2,7,2,2,2,3,2,2,2,7,8,8,8,8,8,8,9,10,2,2,2,2,2,2,3,7],c:[{n:[140,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,147,0,0,0,145,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,133,0,0,0,135,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,130,0,0,0,133,0,0,0,135,0,0,0]},{n:[145,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,145,0,0,0,147,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[135,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,145,0,0,0,147,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,137,0,0,0,138,0,0,0,137,0,0,0,133,0,0,0,135,0,0,0]},{n:[135,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,145,0,0,0,147,0,0,0]},{n:[137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,142,0,0,0,145,0,0,0,147,0,0,0]},{n:[140,0,0,0,0,0,0,0,152,0,0,0,149,0,0,0,150,0,0,0,149,0,0,0,145,0,0,0,147,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:123,osc1_waveform:1,osc2_oct:8,osc2_det:0,osc2_detune:25,osc2_xenv:1,osc2_vol:166,osc2_waveform:0,noise_fader:0,env_attack:37768,env_sustain:19084,env_release:24610,env_master:43,fx_filter:4,fx_freq:4798,fx_resonance:167,fx_delay_time:8,fx_delay_amt:93,fx_pan_freq:6,fx_pan_amt:61,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:3,lfo_amt:67,lfo_waveform:0,p:[0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,3,2,2,2,2,2,2,2,3,5,5,5,5,5,5,5,6,2,2,2,2,2,2,2,3],c:[{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,135,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,147,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,149,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]}],songLen:80};function getTime(e){return(""+(100*e|0)/100).replace(".",":")}function getSeconds(e){return-1!==e.indexOf(":")?e.substr(0,e.indexOf(":")):"0"}function getMilliseconds(e){return-1!==e.indexOf(":")?e.substr(e.indexOf(":")+1):"0"}function getBestTime(){bestTimes=kontra.store.get("js13k-2018:best")||{},bestTime=bestTimes[songName]||"0:00"}function setBestTime(){isBetterTime(audio.currentTime)&&(bestTime=getTime(audio.currentTime),bestTimes[songName]=bestTime,kontra.store.set("js13k-2018:best",bestTimes))}function isBetterTime(e){return e>parseInt(bestTime.replace(":","."))}async function main(){setFontMeasurement(),getBestTime(),loadingScene.show();let e=new sonantx.MusicGenerator(song),t=[];t.push(new Promise(t=>{e.createAudioBuffer(function(e){window.kyleBugger=buffer=e,console.log("buffer"),t()})})),Promise.all(t).then(()=>{generateWaveData(),loadingScene.hide(()=>{menuScene.show(()=>startBtn.focus())})})}main();
